package com.sample.dao;

import static com.sample.utils.ConnectionUtils.getConnection;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.sample.vo.Department;
import com.sample.vo.Employee;
import com.sample.vo.Location;

public class DepartmentDao {

	public List<Department> getAllDepartments() throws SQLException {
		String sql = "select D.department_id, D.department_name, E.employee_id, E.first_name, E.last_name, L.location_id, L.city "
				   + "from departments D, employees E, locations L "
				   + "where D.manager_id = E.employee_id(+) "
				   + "and D.location_id = L.location_id "
				   + "order by D.department_id asc ";
		
		List<Department> departments = new ArrayList<>();
		
		Connection connection = getConnection();
		PreparedStatement pstmt = connection.prepareStatement(sql);
		ResultSet rs = pstmt.executeQuery();
		
		while (rs.next()) {
		 Department department = new Department();
		 Employee manager = new Employee();
		 Location location = new Location();
		 
		 
		 
		 department.setId(rs.getInt("D.department_id"));
		 department.setName(rs.getString("D.department_name"));
		 department.setManager(manager);
		 department.setLocation(location);
		 
		}
		
		rs.close();
		pstmt.close();
		connection.close();
		
		return departments;
	}
}
